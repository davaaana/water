"use strict";var ApplicationConfiguration=function(){var applicationModuleName="vatpsPortal",applicationModuleVendorDependencies=["ngResource","ui.router","ui.bootstrap","ui.utils","ngDialog","vatrps.liveChat","uiGmapgoogle-maps","ngCkeditor","ngSanitize","ngtimeago","angulike","ui.grid","angularUtils.directives.dirPagination","ui.bootstrap.datetimepicker"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$httpProvider","uiGmapGoogleMapApiProvider",function($locationProvider,$httpProvider,GoogleMapApiProviders){$locationProvider.hashPrefix("!"),GoogleMapApiProviders.configure({mongolia:!0})}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("admin"),ApplicationConfiguration.registerModule("clientchat"),ApplicationConfiguration.registerModule("consumer"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("livechat"),ApplicationConfiguration.registerModule("merchants"),ApplicationConfiguration.registerModule("operators"),ApplicationConfiguration.registerModule("users"),angular.module("admin").controller("AdminController",["$rootScope","$scope","$stateParams","$location","$http","$filter","Authentication","$modal","$timeout",function($rootScope,$scope,$stateParams,$location,$http,$filter,Authentication,ngDialog){Authentication.authorize(Authentication.user_roles.admin)||$location.path("/"),$scope.onlineUsers=Math.floor(10*Math.random()+1),$scope.currentPage=1,$scope.pageSize=10,$scope.menus=[{title:"Dashboard",href:"#!/admin"},{title:"Сугалаа",href:"#!/admin/lottery"},{title:"Контент",href:"#!/admin/content"},{title:"Faq",href:"#!/admin/faq"},{title:"Статик хуудсууд",href:"#!/admin/static"},{title:"Файл менежер",href:"#!/admin/filemanager"},{title:"Мессеж",href:"#!/admin/message"},{title:"Гарах",href:"#!/auth/signout"}],$scope.account_type=[{label:"Оператор",value:3},{label:"Мерчант",value:2},{label:"Консумер",value:1},{label:"Төрөл сонгоогүй байна",value:1}],$scope.static_pages=[{title:"Шилдэг 10 аж ахуйн нэгж",type:"top-a"},{title:"Шилдэг оператор компаниуд",type:"top-o"},{title:"Сугалааны азтан",type:"top-l"}],$scope.lotteryNumber=[],$scope.lotteryAdd=function(){console.log($scope.lotteryNumber);var a=[];$scope.lotteryNumber.forEach(function(e,i){try{parseInt(e)>0&&a.push(pd(e,2))}catch(e){}}),console.log($scope.lotteryNumber),a=a.join(","),console.log(a),$http.get("/api/v1/getMatchLottery?matched_number={0}&merchant_id={1}".format(a,1530220)).success(function(message){$rootScope.notifyMessage={message:a,type:1}}).error(function(message){$rootScope.notifyMessage="Алдаа гарлаа"})},$scope.lottery=function(){$http.get("/api/v1/admin/lottery").success(function(data){$scope.lotterylists=data}).error(function(data){})},$scope.sumReadCount=function(){$scope.count=0,$http.get("/article_get_counter").success(function(data){for(var i=0;i<data.length;i++)$scope.count=$scope.count+data[i].count.low}).error(function(){})},$scope.messageList=function(){$http.get("/api/v1/admin/message").success(function(data){$scope.messageLists=data}).error(function(){})},$scope.messageSent=function(data){$http.post("/api/v1/admin/message",{role:data.role.value,title:data.title,detail:data.detail}).success(function(message){$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message})},$scope.messageDelete=function(id,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Захиа",message:"Та энэ захиаг устгах уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http["delete"]("/api/v1/admin/message/{0}".format(id)).success(function(message){$scope.messageLists.splice(index,1),$rootScope.notifyMessage=message}).error(function(){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.counter=function(){$http.get("/counters").success(function(data){$scope.counters=data.rows[1].count.low}).error(function(){})},$scope.newsmark=function(){$http.get("/api/v1/admin/articles/feature").success(function(data){$scope.newsmarklists=data||[]}).error(function(data){})},$scope.newsall=function(){$http.get("/api/v1/admin/articles").success(function(data){$scope.newsarticlelists=data}).error(function(data){})},$scope.staticPageDetailGet=function(){console.log("static pages id: "+$stateParams.id),$http.get("/api/v1/admin/staticPage/{0}".format($stateParams.id)).success(function(data){$scope.spdetail=data,console.log("static pages: "+$scope.spdetail)}).error(function(){})},$scope.staticPageDetailAdd=function(data){$http.put("/api/v1/admin/staticPage",{id:$stateParams.id,page_detail:data.page_detail,page_link:data.page_link}).success(function(message){$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message})},$scope.staticPageDelete=function(id,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Хуудас",message:"Та энэ хуудасыг устгах уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http["delete"]("/api/v1/admin/staticPage/{0}".format(id)).success(function(message){$rootScope.notifyMessage=message,$scope.staticpageslist.splice(index,1)}).error(function(){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.staticPageAdd=function(params){$http.post("/api/v1/admin/staticPage",{pagename:params.page_name,pagelink:params.page_link}).success(function(message){params.page_name=void 0,$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message})},$scope.staticPageList=function(){$http.get("/api/v1/admin/staticPage").success(function(data){$scope.staticpageslist=data})},$scope.faqUpdate=function(params){$http.put("/api/v1/admin/faq/{0}".format($stateParams.id),{answer:params.answer,question:params.question}).success(function(message){$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message})},$scope.getFaqUpdate=function(){$http.get("/api/v1/admin/faq/{0}".format($stateParams.id)).success(function(data){$scope.editFaqs=data[0]}).error(function(data){})},$scope.faqDelete=function(id,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"FAQ",message:"Та энэ FAQ устгах уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http["delete"]("/api/v1/admin/faq/{0}".format(id)).success(function(message){$rootScope.notifyMessage=message,$scope.faqlists.splice(index,1)}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.faqAdd=function(datas){$http.post("/api/v1/admin/faq",{question:datas.question,answer:datas.answer}).success(function(message){datas.question=void 0,datas.answer=void 0,$rootScope.notifyMessage=message}).error(function(data){$rootScope.notifyMessage=message})},$scope.faqlist=function(){$http.get("/api/v1/admin/faq").success(function(data){$scope.faqlists=data})},$scope.go=function(path){$location.path(path)},$scope.articlemark=function(id,ismark){$http.put("/api/v1/admin/articles/{0}/mark/{1}".format(id,ismark))},$scope.exit=function(){$location.path("/admin/content")},$scope.save_exit=function(){},$scope.save_clear=function(data){data.title=void 0},$scope.filemanager=function(){$http.get("/api/v1/filemanager").success(function(data){$scope.filelists=data})},$scope.filedelete=function(id,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Файл",message:"Та энэ файл-г устгах уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http["delete"]("/api/v1/filemanager/{0}".format(id)).success(function(message){$scope.filelists.splice(index,1),$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.find=function(){$http.get("/api/v1/admin/articles").success(function(data){$scope.articles=data})},$scope.imageUpload=function(){$http.post("/api/v1/filemanager/upload",{files:$scope.files}).success(function(message){$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message})},$scope.createArticle=function(article,type){$http.post("/api/v1/admin/articles",{title:article.title,shortdetail:article.shortdetail,detail:article.detail,description:article.description,imgpath:$scope.imgpath,ismark:article.ismark,gmtdate:$filter("date")(new Date,"yyyy-MM-dd HH:mm:ss Z")}).success(function(message){switch($rootScope.notifyMessage={message:"Амжилттай нэмэгдлээ",type:1},type){case 1:$location.path("/admin/content");break;case 2:article.title=void 0,article.shortdetail=void 0,article.detail=void 0,article.description=void 0,article.imgpath=void 0,article.ismark=!1}}).error(function(message){$rootScope.notifyMessage=message})},$scope.updateArticle=function(article){$http.put("/api/v1/admin/articles/{0}".format($stateParams.id),{title:article.article_title,shord_detail:article.article_short_detail,detail:article.article_detail,description:article.article_description,imgpath:$scope.article_imgpath}).success(function(message){$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message})},$scope.getUpdate=function(){$http.get("/api/v1/admin/articles/{0}".format($stateParams.id)).success(function(data){$scope.editArticles=data})},$scope.articledelete=function(id,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Мэдээ",message:"Та энэ мэдээг устгах уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http["delete"]("/api/v1/admin/articles/{0}".format(id)).success(function(message){$scope.articles.splice(index,1),$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.model={name:"",comments:""},$scope.files=[],$scope.$on("fileSelected",function(event,args){$scope.$apply(function(){console.log("image uploaded"),$scope.files.push(args.file),$scope.save(),$scope.files=[]})}),$scope.save=function(){$http({method:"POST",url:"/api/v1/filemanager/upload",headers:{"Content-Type":void 0},transformRequest:function(data){var formData=new FormData;formData.append("model",angular.toJson(data.model));for(var i=0;i<data.files.length;i++)formData.append("file"+i,data.files[i]);return formData},data:{model:$scope.model,files:$scope.files}}).success(function(data){$rootScope.notifyMessage={message:"Амжилттай нэмэгдлээ",type:1},$scope.imgpath="/img/"+data.file0.name}).error(function(){$rootScope.notifyMessage={message:"Амжилтгүй боллоо1",type:0}})},$scope.$watch("lotteryNumber",function(o,n){if(!(void 0!=n&&n.length>1&&" "==n.substring(n.length-1,n.length))&&void 0!=$scope.lotteryNumber)switch(o.length){case 2:$scope.lotteryNumber+=" ";break;case 5:$scope.lotteryNumber+=" ";break;case 8:$scope.lotteryNumber+=" ";break;case 11:$scope.lotteryNumber+=" ";break;case 14:$scope.lotteryNumber+=" "}})}]),angular.module("admin").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin",{url:"/admin","abstract":!0,templateUrl:"modules/admin/views/index-admin.client.view.html"}).state("admin.dashboard",{url:"",templateUrl:"modules/admin/views/dashboard-admin.client.view.html"}).state("admin.content",{url:"/content",templateUrl:"modules/admin/views/content-admin.client.view.html"}).state("admin.add",{url:"/content/add",templateUrl:"modules/admin/views/add-content-admin.client.view.html"}).state("admin.edit",{url:"/content/edit/:id",templateUrl:"modules/admin/views/edit-content-admin.client.view.html"}).state("admin.filemanager",{url:"/filemanager",templateUrl:"modules/admin/views/filemanager-admin.client.view.html"}).state("admin.faq",{url:"/faq",templateUrl:"modules/admin/views/faq-admin.client.view.html"}).state("admin.faqadd",{url:"/faq/add",templateUrl:"modules/admin/views/add-faq-admin.client.view.html"}).state("admin.faqedit",{url:"/faq/edit/:id",templateUrl:"modules/admin/views/edit-faq-admin.client.view.html"}).state("admin.staticpages",{url:"/static",templateUrl:"modules/admin/views/static-pages-admin.client.view.html"}).state("admin.staticpagesadd",{url:"/static/add",templateUrl:"modules/admin/views/add-static-pages-admin.client.view.html"}).state("admin.staticpagesdetail",{url:"/static/detail/:id",templateUrl:"modules/admin/views/detail-static-pages-admin.client.view.html"}).state("admin.lottery",{url:"/lottery",templateUrl:"modules/admin/views/lottery-admin.client.view.html"}).state("admin.message",{url:"/message",templateUrl:"modules/admin/views/message-admin.client.view.html"}).state("admin.messagesend",{url:"/message/send",templateUrl:"modules/admin/views/add-message-admin.client.view.html"})}]),angular.module("clientchat").controller("ClientchatController",["$scope","$stateParams","$location","socket","Authentication","$http",function($scope,$stateParams,$location,socket,auth,$http){auth.authorize(auth.user_roles.operator)||$location.path("/");var names=["Г.Ган-Оргил","Д.Жавхлантөгс","Бүүвэй","Д.Очирпрэв","Б.Рагчаабазар"];$scope.controllerName="Client Chat Controller",$scope.username=$scope.fullname=names[Math.round(5*Math.random())],$scope.messages=[],socket.emit("init",{fullname:$scope.fullname,operator:!1}),$scope.sendMessage=function(message,username){message&&""!==message&&username&&($scope.messages.push({username:username,content:message}),socket.emit("Client2Operator",message))},socket.on("Operator2Client",function(data){$scope.messages.push(data)})}]),angular.module("clientchat").config(["$stateProvider",function($stateProvider){$stateProvider.state("clientchat",{url:"/clientchat",templateUrl:"modules/clientchat/views/index-clientchat.client.view.html"})}]),angular.module("consumer").controller("ConsumerAccountsController",["$rootScope","$scope","$http","Authentication","BankAccountService",function($rootScope,$scope,$http,Auth,BankAccountService){function getListRequest(){BankAccountService.listRequest().then(function(results){results.forEach(function(el){"0"==el.request_status?$scope.myRequestList.push(el):$scope.inRequestList.push(el)})})}$scope.user=$scope.$parent.user,$scope.oneAtATime=!0,$scope.searchText="",$scope.requestUserList=[],$scope.bankList=getDropdownBankList(),$scope.selectedBank={},$scope.accountNumber="",$scope.result=!1,$scope.selectBankValid=!1,$scope.resultCheck=0,$scope.searchTextA="",$scope.inRequestList=[],$scope.myRequestList=[],$scope.$emit("eventListRequest"),$scope.$on("eventListRequest",function(){getListRequest()}),$scope.cancelAccount=function(accNumber,selBank){if(!$scope.selectedBank.id||void 0==$scope.selectedBank.id)return void($scope.selectBankValid=!0);var foundAcc,foundName;$rootScope.accounts.forEach(function(el,i){el.accnumber==accNumber&&el.bankid==selBank.id&&(foundAcc=1,el.login_name==user.id&&(foundName=1,BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Данс",message:"Та энэ дансыг цуцлах уу ?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){BankAccountService.cancelAccount(el.id,el.accnumber).then(function(data){$rootScope.notifyMessage={message:"Данс цуцлагдлаа",type:1},$rootScope.accounts.splice(i,1),$rootScope.activateAccount.accnumber==accNumber&&($rootScope.activateAccount=[])}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})))}),1!=foundAcc?$rootScope.notifyMessage={message:"Танд энэ данс байхгүй байна.",type:1}:1!=foundName&&($rootScope.notifyMessage={message:"Таны данс биш байна.",type:1}),$scope.selectedBank={},$scope.accountNumber=""},$scope.search=function(text){BankAccountService.search(text).then(function(data){$scope.result=void 0!=data.type?data:data[0]})},$scope.requestSend=function(data){BankAccountService.requestSend(data.login_name).then(function(){$rootScope.notifyMessage={message:"Хүсэлт илгээгдлээ",type:1},$scope.result=!1,$scope.$emit("eventListRequest")})},$scope.getDescStatus=function(status){return 0==status?"Хүлээгдэж байна":1==status?"Зөвшөөрсөн":2==status?"Татгалзсан":3==status?"Татгалзсан":void 0},$scope.bankSelectChange=function(){$scope.selectBankValid=!1},$scope.createAccount=function(){if(!$scope.selectedBank.id||void 0==$scope.selectedBank.id)return void($scope.selectBankValid=!0);var params={accnumber:$scope.accountNumber,bankid:$scope.selectedBank.id,bankname:$scope.selectedBank.name},foundAcc=!1;$rootScope.accounts.forEach(function(el,i){el.accnumber==$scope.accountNumber&&(foundAcc=!0)}),foundAcc?$rootScope.notifyMessage={message:"Данс бүртгэлтэй байна",type:2}:BankAccountService.createAccount(params).then(function(){$rootScope.$emit("AccountList"),console.log(params),$rootScope.notifyMessage={message:"Таны данс бүртгэгдлээ",type:1},$scope.accountNumber="",$scope.selectedBank={}})},$scope.accept=function(item){BankAccountService.accept(item.user1,item.user2).then(function(result){item.action_status=1})},$scope.reject=function(item,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Данс",message:"Та энэ хүсэлтээс татгалзах уу ?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){BankAccountService.reject(item.user1,item.user2).then(function(result){item.action_status=2}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.cancel=function(item,index,reqType){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Данс",message:"Та энэ хүсэлтийг цуцлах уу ?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){BankAccountService.cancel(item.user1,item.user2).then(function(result){1==reqType&&$scope.inRequestList.splice(index,1),0==reqType&&$scope.myRequestList.splice(index,1)}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.cancelMulti=function(item,index,reqType){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Данс",message:"Та энэ хүсэлтийг цуцлах уу ?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){BankAccountService.cancelMulti(item.user1,item.user2).then(function(result){1==reqType&&$scope.inRequestList.splice(index,1),0==reqType&&$scope.myRequestList.splice(index,1)}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})}}]),angular.module("consumer").controller("ConsumerAccountsActivateController",["$rootScope","$scope","$http","BankAccountService",function($rootScope,$scope,$http,BankAccountService){function init(){BankAccountService.listAccount().then(function(results){var extendAccounts=[];BankAccountService.getActivateAccount().then(function(data){results.forEach(function(el){el.accnumber==data.accnumber&&el.bankid==data.bankid?($rootScope.activateAccount=el,extendAccounts.push(_.extend(el,{isActivate:!0}))):extendAccounts.push(_.extend(el,{isActivate:!1}))}),isEmpty(data)&&($rootScope.activateAccount=[])}),$rootScope.accounts=extendAccounts})}$rootScope.accounts=[],$rootScope.activateAccount=[],$rootScope.$on("AccountList",function(){init()}),init(),$scope.confirm=function(account){BankAccountService.activate(account.accnumber,account.bankid,account.login_name).then(function(result){$rootScope.notifyMessage=result,$rootScope.activateAccount=account,$scope.accounts.forEach(function(el){el.isActivate=!1}),account.isActivate=!0})}}]),angular.module("consumer").controller("ConsumerController",["$rootScope","$scope","$stateParams","$location","Authentication","$http",function($rootScope,$scope,$stateParams,$location,Auth,$http){Auth.authorize(Auth.user_roles.consumer)||$location.path("/");var sysDate=new Date;$scope.lotteryBegin="",$scope.lotteryEnd="",void 0==$.cookie("firstpopover")&&($.cookie("firstpopover",1),$("body").append("<div class='first-pop'><div class='first-pop-body'><div class='first-pop-body-header'>НӨАТУС СИСТЕМД НЭВТЭРСЭН ТАНД БАЯРЛАЛАА<button class='first-top-close first-close pull-right'><span class='glyphicon glyphicon-remove'></span></button></div><div class='first-pop-body-main'><a class='first-close' href='/#!/news/4b1a7310-d1c3-11e4-8854-59e52e2e31db'><img src='/media/images/promotion.jpg'></a></div></div></div>"),$("body").css("overflow","hidden"),$(".first-close").on("click",function(){$(".first-pop").remove(),$(".first-pop-body").remove(),$("body").css("overflow","auto")})),$scope.menus=[{title:"Хянах самбар",href:"#!/consumer"},{title:"Урамшуулал ?",href:"#!/consumer/refund"},{title:"Сугалаа авах",href:"#!/consumer/lottery"},{title:"Баримт шалгах",href:"#!/consumer/receipt"},{title:"Дансны мэдээлэл",href:"#!/consumer/accounts"},{title:"Гар утсанд",href:"#!/consumer/apphone"},{title:"БАЙРШИЛ",href:"#!/consumer/location"},{title:"Хувийн Тохиргоо",href:"#!/consumer/setting"}],$scope.saveBtn=!0,$scope.user=Auth.user,$scope.consumerFormDisable=!0,$scope.banklist=[],$scope.chart1disable=!0,$scope.chart2disable=!0,$scope.chart3disable=!0,$scope.sales_list=[],$scope.pageTop=function(){pageTop()},$scope.categoryPercent={a:0,b:0,c:0,d:0},$http.get("/users/getImage").success(function(data){$scope.user.image=data.image}).error(function(data){}),$scope.init=function(){$scope.chartData1=[],$http.get("/api/v1/sales/list").success(function(data){$scope.sales=data}).error(function(data){}),$http.get("/api/v1/lottery/list").success(function(data){$scope.lotteryOwnGrid=data,$scope.tableShow=data.length>0?!0:!1;for(var i in data){var splt=data[i].lottery.toString().split(" "),lotteries={A:splt[0],B:splt[1],C:splt[2],D:splt[3],E:splt[4],F:splt[5]};data[i].lotteries=lotteries}$scope.lotteries=data,$scope.tableShow=!0}).error(function(data){$scope.tableShow=!1}),$http.get("/api/v1/consumer/purchaseByItem").success(function(data){$scope.sales_list=data,$scope.sales_list_null=0;var a,b,c,d,sumAmount=0;a=b=c=d=0,0!=data.length&&(data.forEach(function(el){switch(0==el.cat_type&&($scope.sales_list_null+=1),el.cat_type){case 1:a+=el.amount;break;case 2:b+=el.amount;break;case 3:c+=el.amount;break;case 4:d+=el.amount}sumAmount+=el.amount}),$scope.categoryPercent.a=Math.round(100*a/sumAmount),$scope.categoryPercent.b=Math.round(100*b/sumAmount),$scope.categoryPercent.c=Math.round(100*c/sumAmount),$scope.categoryPercent.d=Math.round(100*d/sumAmount),$rootScope.$on("catItem",function(event,args){1==args.catType&&($scope.categoryPercent.a=Math.round((a+=100*args.amount)/sumAmount)),2==args.catType&&($scope.categoryPercent.b=Math.round((b+=100*args.amount)/sumAmount)),3==args.catType&&($scope.categoryPercent.c=Math.round((c+=100*args.amount)/sumAmount)),4==args.catType&&($scope.categoryPercent.d=Math.round((d+=100*args.amount)/sumAmount))})),$rootScope.$on("catItem",function(event,args){1==args.catType&&($scope.categoryPercent.a=Math.round((a+=100*args.amount)/sumAmount)),2==args.catType&&($scope.categoryPercent.b=Math.round((b+=100*args.amount)/sumAmount)),3==args.catType&&($scope.categoryPercent.c=Math.round((c+=100*args.amount)/sumAmount)),4==args.catType&&($scope.categoryPercent.d=Math.round((d+=100*args.amount)/sumAmount))})}).error(function(data){}),$scope.vatAmountBankLists=[],$http.get("/api/v1/consumer/vatAmountBank").success(function(results){$scope.vatAmountBankLists=[];var sumVatAmountBank=0;results.forEach(function(el){getDropdownBankList().forEach(function(el1){el.bankid==el1.id&&($scope.vatAmountBankLists.push(_.extend(el,el1)),sumVatAmountBank+=el.vat_amount)})}),$scope.sumVatAmountBank=sumVatAmountBank})},$scope.getBankRefund=function(bankid){var ret=0;return $scope.banklist.forEach(function(item){return item.bankid==bankid?ret=item.value:void 0}),ret},$scope.gridOptions2={data:"lotteryOwnGrid",showGridFooter:!1,showColumnFooter:!1,enableSorting:!0,paginationPageSizes:[5,10,15],paginationPageSize:5,enableFiltering:!0,columnDefs:[{field:"account_id",displayName:"Хэрэглэгчийн нэр"},{field:"created_date",displayName:"Сугалааны огноо",date:"yyyy-MM-dd"},{field:"lottery",displayName:"Сугалааны дугаар"}]},$scope.dialogPrint=function(e){$("#printBtn").hide();var orginalContent=document.body.innerHTML,printContents=$("#dialogPrint").html();document.body.innerHTML=printContents,window.print(),document.body.innerHTML=orginalContent,window.location.reload()},$scope.files=[],$scope.$on("fileSelected",function(event,args){$scope.$apply(function(){return $scope.files.push(args.file),args.file.size/1024>1024?void($rootScope.notifyMessage={message:"Таны оруулсан зураг хэтэрхий том байна 1mb-аас бага хэмжээтэй зураг оруулана уу",type:0}):($scope.saveBtn=!1,$scope.accountImageChange(),void($scope.files=[]))})}),$scope.catList=[],$scope.catList.push({name:"Орон сууц",id:1,select:"selected"}),$scope.catList.push({name:"Тээврийн хэрэгсэл",id:2}),$scope.catList.push({name:"Хүнс, ахуйн хэрэглээ",id:3}),$scope.catList.push({name:"Харилцаа холбоо",id:4}),$scope.setCategoryType=function(idx,id,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Ангилал",message:function(dialog){var innerHtml="";$scope.catList.forEach(function(el,i){innerHtml+='<option value="'+el.id+'" '+el.select+"> "+el.name+" </option>"});var $content2='<select id="consumer-category-type" class="form-control"><option value="" disabled> -- Ангилалаа сонгоно уу -- </option>'+innerHtml+"</select>";return $content2},buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){var catType=$("#consumer-category-type option:selected").val();$http.put("/api/v1/consumer/setCategoryType/{0}/{1}".format(index,catType)).success(function(data){$scope.$emit("catItem",{catType:catType,amount:$scope.sales_list[idx].amount}),$scope.sales_list_null-=1,$scope.sales_list.splice(idx,1)}).error(function(data){alert("error")}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){dialogItself.close()}}]})},$scope.close=function(){$("#close").click(function(){$("#modalBackdrop").css("display","none"),$("#dialogBox").css("display","none")})},$scope.getReceiptCheck=function(num){$("#request").css("display","block"),$("#request").attr("src","/img/loading.gif"),void 0!=num&&num?$http.get("/api/v1/consumer/receiptCheck/{0}".format(num)).success(function(data){$("#modalBackdrop").css("display","block"),$("#dialogBox").css("display","block"),$("#request").css("display","none"),isEmpty(data)?$rootScope.notifyMessage={message:"Баримтын дугаараар баримт олдсонгүй",type:0}:$scope.lotteryCheck=data}).error(function(data){$("#request").css("display","none"),$("#modalBackdrop").css("display","none"),$("#dialogBox").css("display","none"),$rootScope.notifyMessage=data}):($("#request").css("display","none"),$rootScope.notifyMessage={message:"Та баримтын дугаар оруулана уу?",type:0})},$scope.accountImageChange=function(){$http({method:"POST",url:"/api/v1/filemanager/upload",headers:{"Content-Type":void 0},transformRequest:function(data){var formData=new FormData;formData.append("model",angular.toJson($scope.user));for(var i=0;i<data.files.length;i++)formData.append("file"+i,data.files[i]);return formData},data:{model:$scope.model,files:$scope.files}}).success(function(data,status,headers,config){Auth.user.image="/img/"+data.file0.name}).error(function(data,status,headers,config){$rootScope.notifyMessage={message:"Зураг солиход алдаа гарлаа: "+data,type:2}})},$scope.toggleModal=function(){$scope.showModal=!1,$scope.showModal=!$scope.showModal},$scope.lotteryTransactions=[],$scope.getLotteryTransaction=function(){var a=monthBySearch(sysDate);$scope.lotteryBegin=a.begin,$scope.lotteryEnd=a.end,$http.get("/api/v1/lottery/lotteryTransaction/{0}/{1}".format($scope.lotteryBegin,$scope.lotteryEnd)).success(function(results){$scope.lotteryTransactions=results})},$scope.getLotteryTransactionDown=function(){sysDate=new Date(new Date(sysDate).setMonth(sysDate.getMonth()-1));var a=monthBySearch(sysDate);$scope.lotteryBegin=a.begin,$scope.lotteryEnd=a.end,$http.get("/api/v1/lottery/lotteryTransaction/{0}/{1}".format($scope.lotteryBegin,$scope.lotteryEnd)).success(function(results){$scope.lotteryTransactions=results})},$scope.getLotteryTransactionUp=function(){sysDate=new Date(new Date(sysDate).setMonth(sysDate.getMonth()+1));var a=monthBySearch(sysDate);$scope.lotteryBegin=a.begin,$scope.lotteryEnd=a.end,$http.get("/api/v1/lottery/lotteryTransaction/{0}/{1}".format($scope.lotteryBegin,$scope.lotteryEnd)).success(function(results){$scope.lotteryTransactions=results})},$scope.secondDifferent=function(date){var a=new Date(date),b=new Date,difference=(b-a)/1e3;return 5>difference?!0:!1}}]),angular.module("consumer").config(["$stateProvider",function($stateProvider){$stateProvider.state("consumer",{url:"/consumer","abstract":!0,templateUrl:"modules/consumer/views/index-consumer.client.view.html",controller:"ConsumerController"}).state("consumer.dashboard",{url:"",templateUrl:"modules/consumer/views/dashboard-consumer.client.view.html",title:"Худалдан авагчийн мэдээлэл",controller:"ConsumerDashboardController"}).state("consumer.location",{url:"/location",templateUrl:"modules/consumer/views/location-consumer.client.view.html",controller:"ConsumerLocationController"}).state("consumer.lottery",{url:"/lottery",templateUrl:"modules/consumer/views/lottery-consumer.client.view.html",controller:"ConsumerLotteryController"}).state("consumer.receipt",{url:"/receipt",templateUrl:"modules/consumer/views/receipt-consumer.client.view.html"}).state("consumer.setting",{url:"/setting",templateUrl:"modules/consumer/views/setting-consumer.client.view.html",controller:"ConsumerSettingController"}).state("consumer.edit",{url:"/edit",templateUrl:"modules/consumer/views/setting-consumer.client.view.html"}).state("consumer.accounts",{url:"/accounts",templateUrl:"modules/consumer/views/accounts-consumer.client.view.html",controller:"ConsumerAccountsController"}).state("consumer.refund",{url:"/refund",templateUrl:"modules/consumer/views/refund-consumer.client.view.html",controller:"ConsumerAccountsController"}).state("consumer.apphone",{url:"/apphone",templateUrl:"modules/consumer/views/apphone-consumer.client.view.html",controller:"ConsumerAccountsController"}).state("calendar",{url:"/calendar",templateUrl:"modules/consumer/views/template/calendar.html"})}]),angular.module("consumer").factory("BankAccountService",["$http",function($http){return{createAccount:function(params){var promise=$http.post("/api/v1/accounts/create",{accnumber:params.accnumber,bankid:params.bankid,bankname:params.bankname}).then(function(response){return response.data});return promise},cancelAccount:function(accid,accnumber){var promise=$http["delete"]("/api/v1/accounts/cancel/{0}/{1}".format(accid,accnumber)).then(function(response){return response.data});return promise},listAccount:function(){var promise=$http.get("/api/v1/accounts/list").then(function(response){return response.data});return promise},activate:function(accnumber,bankid,whois){var promise=$http.post("/api/v1/accounts/activate",{
accnumber:accnumber,bankid:bankid,whois:whois}).then(function(response){return response.data});return promise},getActivateAccount:function(){var promise=$http.get("/api/v1/accounts/activate").then(function(response){return response.data});return promise},search:function(text){var promise=$http.get("/api/v1/accounts/request/search?t="+text).then(function(response){return response.data});return promise},requestSend:function(toname){var promise=$http.post("/api/v1/accounts/request/send",{toname:toname}).then(function(response){return response.data});return promise},myRequest:function(){var promise=$http.get("/api/v1/accounts/request/list/fromuser").then(function(response){return response.data});return promise},listRequest:function(){var promise=$http.get("/api/v1/accounts/request/list").then(function(response){return response.data});return promise},inRequest:function(){var promise=$http.get("/api/v1/accounts/request/list/touser").then(function(response){return response.data});return promise},accept:function(id1,id2){var promise=$http.get("/api/v1/accounts/request/accept/{0}/{1}".format(id1,id2)).then(function(response){return response.data});return promise},reject:function(id1,id2){var promise=$http.get("/api/v1/accounts/request/reject/{0}/{1}".format(id1,id2)).then(function(response){return response.data});return promise},cancel:function(id1,id2){var promise=$http.get("/api/v1/accounts/request/cancel/{0}/{1}".format(id1,id2)).then(function(response){return response.data});return promise},cancelMulti:function(id1,id2){var promise=$http.get("/api/v1/accounts/request/cancel/{0}/{1}?multi=1".format(id1,id2)).then(function(response){return response.data});return promise}}}]),angular.module("consumer").controller("ConsumerDashboardController",["$rootScope","$scope","$http","Authentication","BankAccountService",function($rootScope,$scope,$http,Auth,BankAccountService){$scope.user=Auth.user,$scope.gridData=[{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6e3,vat_amount:600,recCount:12,count:5},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6e3,vat_amount:600,recCount:12,count:5},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6e3,vat_amount:600,recCount:12,count:5},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6e3,vat_amount:600,recCount:12,count:5},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6e3,vat_amount:600,recCount:12,count:5},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6e3,vat_amount:600,recCount:12,count:5},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6e3,vat_amount:600,recCount:12,count:5}],$scope.gridOptions={data:"gridData",showGridFooter:!1,enableSorting:!0,paginationPageSizes:[5,10,15],paginationPageSize:5,enableFiltering:!0,columnDefs:[{field:"no",width:"5%",displayName:"№"},{field:"bank",displayName:"Хүлээ авах банк"},{field:"accNo",displayName:"Дансны дугаар"},{field:"receiptNo",displayName:"Баримтын дугаар"},{field:"amount",displayName:"Худалдан авалтын дүн"},{field:"vat_amount",displayName:"Буцаан олголтын дүн"},{field:"recCount",displayName:"Баритмын тоо"},{field:"count",displayName:"Судалгааны эрхтэй баримтын тоо"}]},$scope.gridData=[{cosName:"Номин",date:"2015/02/01",amount:78e4,vat_amount:7800},{cosName:"Номин",date:"2015/02/01",amount:78e4,vat_amount:7800},{cosName:"Номин",date:"2015/02/01",amount:78e4,vat_amount:7800},{cosName:"Номин",date:"2015/02/01",amount:78e4,vat_amount:7800},{cosName:"Номин",date:"2015/02/01",amount:78e4,vat_amount:7800}],$scope.customerGridOption={data:"gridData",showGridFooter:!1,enableSorting:!0,paginationPageSizes:[5,10,15],paginationPageSize:5,width:276,enableFiltering:!0,columnDefs:[{field:"cosName",width:"100",displayName:"Байгууллага"},{field:"date",width:"80",displayName:"Огноо"},{field:"amount",width:"83",displayName:"Мөнгөн дүн"},{field:"vat_amount",width:"60",displayName:"НӨАТ"}]},$scope.gridData1=[{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131}],$scope.gridOptions1={data:"gridData1",showGridFooter:!1,enableSorting:!0,paginationPageSizes:[5,10,15],paginationPageSize:5,enableFiltering:!1,columnDefs:[{field:"no",width:"5%",displayName:"№"},{field:"bank",displayName:"Сугалааны дугаар"},{field:"accNo",displayName:"Бүртгүүлсэн огноо"},{field:"receiptNo",displayName:"Тохирол явах хугацаа"}]},$scope.gridData2=[{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6500},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6500},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6500},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6500},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6500},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6500},{no:1,bank:"ХХБ",accNo:231321,receiptNo:32132131,amount:6500}],$http.get("/api/v1/consumer/purchaseByMonth").success(function(data){data.length>0?(buildChart("chart-consumer-month",data,"month","column"),$scope.chart1disable=!1):$scope.chart1disable=!0}).error(function(data){$scope.chart=data}),$http.get("/api/v1/consumer/purchaseByDay").success(function(data){data.length>0?(buildChart("chart-consumer-day",data,"day","line"),$scope.chart2disable=!1):$scope.chart2disable=!0}).error(function(data){$scope.chart=data,$scope.sales_list=[]})}]),angular.module("consumer").controller("ConsumerLocationController",["$rootScope","$scope","$http","Authentication",function($rootScope,$scope,$http,Auth){var cities=[];$scope.aimags=getAimag(),$scope.sums=getSum("65"),$scope.user=Auth.user,$scope.typeRef=0,$scope.typeLot=0,$scope.mapCenter=new google.maps.LatLng(47.920303,106.918952),$scope.pageTop=function(){pageTop()},$scope.$watch("adahCode",function(e,n){$scope.sumCode=void 0,$scope.sums=getSum(e)}),$scope.listByLocation=function(aimagCode,sumCode){cities=null,cities=[],$scope.typeRef=0,$scope.typeLot=0;var req="/api/v1/consumer/listByLocation";req+=void 0!=aimagCode&&void 0!=sumCode?"?aimag="+aimagCode+"&sum="+sumCode:void 0!=aimagCode?"?aimag="+aimagCode:void 0!=sumCode?"?sum="+sumCode:"?aimag=99",$http.get(req,{user:$scope.user}).success(function(data){if(data.terminals){var typeLot=0,typeRef=0;null!=data.terminals[0]&&($scope.posLocation=data.terminals,$scope.mapCenter=new google.maps.LatLng($scope.posLocation[0].latitude,$scope.posLocation[0].longitude),$scope.posLocation.forEach(function(el){"1"==el.type?typeLot++:typeRef++,el&&el.longitude&&el.latitude&&cities.push({longitude:el.longitude,latitude:el.latitude,type:el.type,title:el.merchantName,time:el.regDate,address:el.address})}),$scope.typeLot=typeLot,$scope.typeRef=typeRef),$scope.initMap()}else $scope.initMap()}).error(function(message){cities=[],$scope.initMap()})},$scope.initMap=function(){var mapProp={center:$scope.mapCenter,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(document.getElementById("googleMap"),mapProp),infowindow=new google.maps.InfoWindow;cities.forEach(function(el){var icon;icon="1"==el.type?"img/lottery_pin.png":"img/refund_pin.png";var marker=new google.maps.Marker({position:new google.maps.LatLng(el.latitude,el.longitude),map:map,icon:icon}),content='<table style=""><tbody><tr class="map-header"><td>Байгууллагын нэр:</td><td>'+el.title+'</td></tr><tr></tr><tr></tr><tr class="map-content"><td class="map-cell1">Хаяг:</td><td>'+el.address+'</td></tr><tr class="map-content"><td>Цагийн хуваарь:</td><td>'+el.time+"</td></tr></tbody>";google.maps.event.addListener(marker,"click",function(e){infowindow.setContent(content),infowindow.open(map,marker)})})}}]),angular.module("consumer").controller("ConsumerLotteryController",["$rootScope","$scope","$http","Authentication","BankAccountService",function($rootScope,$scope,$http,Auth,BankAccountService){$scope.user=Auth.user,$scope.getLottery=function(num){$("#request").css("display","block"),$("#request").attr("src","/img/loading.gif"),void 0!=num&&num?$http.get("/api/v1/consumer/lottery?rrn={0}".format(num)).success(function(data){$("#modalBackdrop").css("display","block"),$("#dialogBox").css("display","block"),$("#request").css("display","none"),$scope.lottery=data,$scope.error_messages=0}).error(function(data){$rootScope.notifyMessage=data,$("#request").css("display","none"),$("#modalBackdrop").css("display","none"),$("#dialogBox").css("display","none")}):($rootScope.notifyMessage={message:"Та сугалааны дугаар оруулана уу?",type:0},$("#request").css("display","none"))},$scope.LotteryValidate=function(num){if(12!=num.length||!isNumberV(num))return void($rootScope.notifyMessage={message:"Та 12 оронтой тоо оруулана уу",type:0});$("#request1").css("display","block"),$("#request1").attr("src","/img/loading.gif");var data=num.split("");data.splice(2,0," "),data.splice(5,0," "),data.splice(8,0," "),data.splice(11,0," "),data.splice(14,0," "),data=data.toString(),data=data.replace(/,/g,"");$http.get("/api/v1/consumer/lotteryValidate?lottery={0}".format(data)).success(function(data){$("#request1").css("display","none"),$http.get("/api/v1/lottery/lotteryTransaction").success(function(results){$scope.lotteryTransactions=results}),$rootScope.notifyMessage=data}).error(function(data){$rootScope.notifyMessage=data,$("#request1").css("display","none")})}}]),angular.module("consumer").controller("ConsumerSettingController",["$rootScope","$scope","$http","Authentication","BankAccountService",function($rootScope,$scope,$http,Auth,BankAccountService){$scope.user=Auth.user,$scope.saveConsumer=function(){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Хэрэглэгчийн мэдээлэл",message:"Хэрэглэгчийн мэдээлэлийг хадгалахдаа итгэлтэй байна уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http.put("/users",{user:$scope.user}).success(function(message){$rootScope.notifyMessage=message,$scope.saveBtn=!0}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){$scope.saveBtn=!0,dialogItself.close()}}]})},$scope.passwordChange=function(oldPass,newPass,confPass){newPass==confPass&&""!=newPass&&newPass?BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Нууц үг солих",message:"Та нууц үгээ солихдоо итгэлтэй байна уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http.post("/users/passwordChange",{oldPassword:oldPass,newPassword:newPass}).success(function(message){$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){$scope.saveBtn=!0,dialogItself.close()}}]}):$rootScope.notifyMessage={message:"Нууц үг буруу байна шалгаад дахин оруулана уу",type:0}}}]),angular.module("core").config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/index.html",controller:"HomeController"}).state("introduction",{url:"/introduction",templateUrl:"modules/core/views/introduction.html",controller:"HomeController"}).state("tv-lottery",{url:"/tv-lottery",templateUrl:"modules/core/views/tv-lottery.html",controller:"HomeController"}).state("partner",{url:"/partner",templateUrl:"modules/core/views/partner.html",controller:"HomeController"}).state("system",{url:"/system",templateUrl:"modules/core/views/system_intro.html"}).state("news",{url:"/news",templateUrl:"modules/core/views/news.html",controller:"HomeController"}).state("news-detail",{url:"/news/:id",templateUrl:"modules/core/views/news_detail.html",controller:"HomeController"}).state("faq",{url:"/faq",templateUrl:"modules/core/views/faq.html",controller:"HomeController"}).state("page",{url:"/page/:id",templateUrl:"modules/core/views/static_pages.html",controller:"HomeController"}).state("topcompany",{url:"/top-company",templateUrl:"modules/core/views/top_comany.html"}).state("contact",{url:"/contact_home",templateUrl:"modules/template/contact_home.html"}).state("mobile",{url:"/mobile_bar",templateUrl:"modules/template/mobile_bar_intro.html"}).state("contact-mobile",{url:"/contact-mobile",templateUrl:"modules/template/contact-mobile.html"}).state("intro-mobile",{url:"/intro-mobile",templateUrl:"modules/template/introduction-mobile.html"}).state("answer-mobile",{url:"/answer-mobile",templateUrl:"modules/template/answer-mobile.html"}).state("faq-mobile",{url:"/faq-mobile",templateUrl:"modules/template/faq-mobile.html"}).state("news-mobile",{url:"/news-mobile",templateUrl:"modules/template/news-mobile.html"}).state("law-mobile",{url:"/law-mobile/:id",templateUrl:"modules/template/law-mobile.html"}).state("mta",{url:"/mta",templateUrl:"lottery/mta.html"}).state("mi",{url:"/mi",controller:["$location",function($location){window.location="/lottery"}]}).state("topoperator",{url:"/top-operator",templateUrl:"modules/core/views/top_operator.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","ngDialog",function($scope,Authentication,ngDialog){if($scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.authentication.user){switch($scope.authentication.user.accType){case 0:$scope.userAuthUrl="#!/admin";break;case 1:$scope.userAuthUrl="#!/consumer";break;case 2:$scope.userAuthUrl="#!/merchant";break;case 3:$scope.userAuthUrl="#!/operator"}$scope.loginBtnHide=!0}else $scope.loginBtnHide=!1;$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1}),$scope.loginDialog=function(){console.log("login dialog show"),ngDialog.openConfirm({template:"modalDialogId",className:"ngdialog-theme-default",controller:"LoginDialogCtrl"}).then(function(value){console.log("Modal promise resolved. Value: ",value)})}}]),angular.module("core").controller("FooterController",["$scope","$http",function($scope,$http){$http.get("/counters").then(function(result){result.data.rows.forEach(function(el){"visitors"===el.name&&($scope.visitorCount=el.count.low)})})}]),angular.module("core").run(["$rootScope",function($rootScope){$rootScope.facebookAppId="919898581355295"}]),angular.module("core").filter("tooltipf",function(){return function(input){var output=tooltip(input);return output}}),angular.module("core").controller("HomeController",["$scope","$http",function($scope,$http){$scope.refundAmount=0,$scope.lotteryTransactions=[],$scope.getLotteryTransactoin=function(){return $http.get("/api/v1/lotteryTransaction").success(function(results){$scope.lotteryTransactions=results}),!0},$scope.getRefundAmount=function(){$http.get("/api/v1/refundAmount").success(function(result){animateValue("jackpot-counter",0,result,200)})},$scope.getLotteryTransactoin()&&setInterval(function(){$scope.getLotteryTransactoin()},5e3)}]),angular.module("core").controller("NewsController",["$rootScope","$scope","$http","$stateParams","$filter",function($rootScope,$scope,$http,$stateParams,$filter){$scope.currentPage=1,$scope.pageSize=5,$scope.sideNewsLimit=5,$scope.saveFaq=function(data){$http.post("/api/v1/userfaq",{name:data.name,email:data.email,detail:data.detail}).success(function(){data.email=void 0,data.name=void 0,data.detail=void 0,$rootScope.notifyMessage={message:"Таны хүсэлт амжилттай илгээгдлээ.",type:1}}).error(function(){$rootScope.notifyMessage={message:"Хүсэлт амжилтгүй боллоо.",type:2}})},$scope.sidenewsmark=function(){$http.get("/api/v1/articles/feature/"+$scope.sideNewsLimit).success(function(data){$scope.sidenewsmarklists=data}).error(function(){})},$scope.sidenewsall=function(){$http.get("/api/v1/articles/top/"+$scope.sideNewsLimit).success(function(data){$scope.sidenewsarticlelists=data}).error(function(){})},$scope.staticPageDetailList=function(){$http.get("/api/v1/staticPage/"+$stateParams.id).success(function(data){$scope.staticPageDetailLists=data})},$scope.absurl=document.URL,$scope.faqlist=function(){$http.get("/api/v1/faq").success(function(data){$scope.faqlists=data}).error(function(data){})},$scope.newsdetail=function(){void 0!==$stateParams.id&&($scope.article_counter($stateParams.id),$http.get("/api/v1/articles/"+$stateParams.id).success(function(data){$scope.detailarticlelist=data,$http.get("/article_get_counter/"+$scope.detailarticlelist.article_id).success(function(count){$scope.counter=count})}).error(function(data){}))},$scope.newsall=function(){$http.get("/api/v1/articles").success(function(data){$scope.newsarticlelists=data}).error(function(data){})},$scope.article_counter=function(id){$http.get("/article_counter/"+id).success(function(data){}).error(function(data){console.log(data)})},$scope.newsall()}]),angular.module("core").controller("SliderController",["$scope","$http",function($scope,$http){function init(){$http.get("/api/v1/articles/top/3").success(function(data){$scope.toparticlelist=data,$scope.toparticlelist.forEach(function(el){$scope.images.push({src:el.article_img,title:el.article_title,id:el.article_id})}),$scope.$broadcast("slideShowInit")}).error(function(data){})}$scope.toparticlelist={},$scope.images=[],init()}]),angular.module("core").directive("slider",["$timeout",function($timeout){return{restrict:"E",replace:!0,scope:{images:"="},link:function(scope,elem,attrs){scope.currentIndex=0,scope.next=function(){scope.currentIndex<scope.images.length-1?scope.currentIndex++:scope.currentIndex=0},scope.prev=function(){scope.currentIndex>0?scope.currentIndex--:scope.currentIndex=scope.images.length-1},scope.$watch("currentIndex",function(){scope.images.forEach(function(image){image.visible=!1}),void 0!==scope.images[scope.currentIndex]&&(scope.images[scope.currentIndex].visible=!0)});var timer,sliderFunc=function(){timer=$timeout(function(){scope.next(),timer=$timeout(sliderFunc,5e3)},5e3)};sliderFunc(),scope.$on("slideShowInit",function(){scope.next()}),scope.$on("$destroy",function(){$timeout.cancel(timer)})},controller:["$scope","$http",function($scope,$http){$scope.article_counter=function(id){$http.get("/article_counter/"+id).success(function(data){}).error(function(data){})}}],templateUrl:"/modules/core/views/templateurl.html"}}]),angular.module("core").directive("dialogDrag",["$document",function($document){return function(scope,element){function mousemove(event){y=event.screenY-startY,x=event.screenX-startX,element.css({top:y+"px",left:x+"px"})}function mouseup(){$document.unbind("mousemove",mousemove),$document.unbind("mouseup",mouseup)}var startX=0,startY=0,x=0,y=0;element.css({position:"fixed",cursor:"move"}),element.on("mousedown",function(event){event.preventDefault(),startX=event.screenX-x,startY=event.screenY-y,$document.on("mousemove",mousemove),$document.on("mouseup",mouseup)})}}]),angular.module("core").directive("fileUpload",function(){return{scope:!0,link:function(scope,el,attrs){el.bind("change",function(event){for(var files=event.target.files,i=0;i<files.length;i++)scope.$emit("fileSelected",{file:files[i],id:attrs.id})})}}}),angular.module("core").directive("validFile",function(){return{require:"ngModel",link:function(scope,el,attrs,ngModel){el.bind("change",function(){scope.$apply(function(){ngModel.$setViewValue(el.val()),ngModel.$render()})})}}}),angular.module("core").directive("notif",["$rootScope","$timeout",function($rootScope,$timeout){return{restrict:"E",replace:!0,link:function($scope){$scope.close=function(){$(".notifId").fadeOut("slow")},$rootScope.$watch("notifyMessage",function(){isEmpty($rootScope.notifyMessage)||(1==$rootScope.notifyMessage.type?($(".notifId").removeClass("noti-error"),$(".notifId").addClass("noti-success"),$(".notif-icon").removeClass("notif-icon-type-error"),$(".notif-icon").addClass("notif-icon-type-success")):($(".notifId").removeClass("noti-success"),$(".notifId").addClass("noti-error"),$(".notif-icon").removeClass("notif-icon-type-success"),$(".notif-icon").addClass("notif-icon-type-error")),$(".notifId").fadeIn("slow"),setTimeout(function(){$(".notifId").fadeOut("slow")},5e3))})},template:'<div class="notifId"><div class="notif-icon"></div><div class="notif-msg"><span>{{notifyMessage.message}}</span><br><br><button class="btn cancel-min" ng-click="close()">Хаах</button></div></div>'}}]),angular.module("core").directive("validFile",function(){return{require:"ngModel",link:function(scope,el,attrs,ngModel){el.bind("change",function(){scope.$apply(function(){ngModel.$setViewValue(el.val()),ngModel.$render()})})}}}),angular.module("core").directive("vatrpsMenu",[function(){var menuTemplate='<div class="dashboard-menu-col" style="z-index: 999999999"><div class="vatps-logged-user"><div class="user-avatar"><img class="img-circle" src="{{avatarUrl}}" ng-src="{{avatarUrl}}" style="width: 70px;height: 70px"/></div><div class="user-name">{{username}}</div><div class="user-work"></div></div><div class="dashboard-menu" id="cssmenu"><ul><li ng-repeat="item in menu"><a ng-href="{{item.href}}"><span>{{item.title}}</span><span class="menu-notif" ng-show="item.notif">{{item.notif}}</span></li><li style="cursor: pointer"><a data-ng-click="exit();"><span>Системээс гарах</span></li></ul></div></div>';return{restrict:"EA",replace:!0,scope:{menu:"=",username:"=",avatarUrl:"="},template:menuTemplate,link:function($scope,elem,attrs){$scope.username||($scope.username="Хэрэглэгч нэр"),$scope.avatarUrl||($scope.avatarUrl="../img/avatar.png"),$scope.menu||($scope.menu=[])},controller:["$scope",function($scope){$scope.exit=function(){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Сануулга",message:"Та системээс гарахдаа итгэлтэй байна уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-sm",action:function(dialogItself){$.removeCookie("firstpopover"),window.location.href="auth/signout",dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-sm",action:function(dialogItself){dialogItself.close()}}]})}}]}}]),angular.module("core").directive("vatrpsTimeLine",["$http","$rootScope",function($http,$rootScope){var timelineTemplate='<div class="time-line" style="margin-left: -20px;height: 600px;overflow-x: hidden;overflow-y: scroll"><div class="containerr" ><ul class="timeline"><span data-ng-model="date" class="time-date">{{date}}</span><li ng-repeat="item in vm.items | orderBy: \'-date\'""><div class="direction-l" data-ng-if="item.origin!=1"><div class="flag-wrapper"><span class="flag" style="width: 120px;display: block"></span><div class="flag-content-l"><span class="" style="width: 120px;display: block;color:#000000">{{item.message}}</span><span class="time-wrapper"><span class="time">{{item.date | date:\'yyyy-MM-dd HH:mm:ss\'}}</span></span></div><div class="desc" style="width: 120px;display: block"></div></div></div><div class="direction-r" data-ng-if="item.origin==1"><div class="flag-wrapper"><span class="flag" style="width: 120px;display: block"></span><div class="flag-content-r"><span class="" style="width: 120px;display: block;color:#000000">{{item.message}}</span><span class="time-wrapper"><span class="time">{{item.date | date:\'yyyy-MM-dd HH:mm:ss\'}}</span></span></div><div class="desc" style="width: 120px;display: block"></div></div></div></li></ul><span data-ng-model="date" class="time-date" style="margin-left: 135px">{{month}}-САР</span><span data-ng-model="date" class="time-date"><span class="glyphicon glyphicon-chevron-down page-down" style="margin-left: 8px" data-ng-click="pagingDown()"></span></span></div></div>';return{restrict:"E",replace:!0,template:timelineTemplate,scope:{username:"="},link:function(scope){},controller:["$scope",function($scope){var vm=this;vm.searchText="",$scope.oldDate="",$scope.pagingDown=function(){if(vm.items[vm.items.length-1]){var index=new Date(vm.items[vm.items.length-1].date);console.log(),index.toDateString(),console.log(index),$http.get("/api/v1/timeline/{0}/{1}".format($scope.username,new Date(index).getTime())).success(function(data){data.forEach(function(el){vm.items.push(el)});var date,month,d=new Date(vm.items[vm.items.length-1].date);date=d.getFullYear(),month=d.getMonth(),$scope.date=date,$scope.month=month+1}).error(function(data){$rootScope.notifyMessage={message:"Алдаа гарлаа.",type:0}})}},$scope.pagingUp=function(){if(vm.items[0]){var index=new Date(vm.items[0].date).getTime();$http.get("/api/v1/timelineup/{0}/{1}".format($scope.username,index)).success(function(data){var date,month;data.forEach(function(el){var d=new Date;date=d.getFullYear(),month=d.getMonth()}),$scope.date=date,$scope.month=month}).error(function(data){$rootScope.notifyMessage={message:"Алдаа гарлаа.",type:0}})}},$http.get("/api/v1/timeline/{0}".format($scope.username)).success(function(data){vm.items=data;var date,month;data.forEach(function(el){var d=new Date;date=d.getFullYear(),month=d.getMonth()}),$scope.date=date,$scope.month=month}).error(function(data){$rootScope.notifyMessage={message:"Алдаа гарлаа.",type:0}})}],controllerAs:"vm"}}]),angular.module("core").factory("socket",["$rootScope",function($rootScope){var socket=io.connect("https://st.vatps.mta.mn/livechat");return{on:function(eventName,callback){socket.on(eventName,function(){var args=arguments;$rootScope.$apply(function(){callback.apply(socket,args)})})},emit:function(eventName,data,callback){socket.emit(eventName,data,function(){var args=arguments;$rootScope.$apply(function(){callback&&callback.apply(socket,args)})})}}}]).run(["$rootScope","$location","Authentication","$state",function($rootScope,$location,au,$state){var processing;$rootScope.g_month1_31=function(){var today=new Date,m=today.getMonth()+1,y=today.getFullYear(),l=2===m?3&y||!(y%25)&&15&y?28:29:30+(m+(m>>3)&1);return"{0}/01 - {1}/{2}".format(m,m,l)},$rootScope.$on("$stateChangeStart",function(ev,to,toParams,from,fromParams){}),$rootScope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){}),$rootScope.$on("$viewContentLoaded",function(event){$rootScope.$emit("changed location",$location.path())}),$rootScope.$on("changed location",function(e,u){var t=5e3;processing=0;var stop=setInterval(function(){processing+=1e3,processing==t&&(clearInterval(stop),showRandomToolTip(u))},1e3)})}]),angular.module("livechat").controller("LivechatLoginController",["$scope","$stateParams","$location",function($scope,$stateParams,$location){$scope.username="",$scope.password="",$scope.login=function(){alert("call login function"),$location.path("/livechat")}}]),angular.module("livechat").controller("LivechatMainController",["$scope","$stateParams","$location","socket",function($scope,$stateParams,$location,socket){$scope.tunnel_users=[],$scope.noreply_users=[],$scope.list_messages=[],$scope.currentClient=null,$scope.username=$scope.fullname="Д.Жавхлантөгс",$scope.password="1",$scope.messages=[],$scope.from=$scope.username,socket.emit("init",{fullname:$scope.fullname,operator:!0}),$scope.$on("changed",function(){console.log("changed"),null!==$scope.currentClient&&($scope.messages=$scope.list_messages[$scope.currentClient.id].messages)}),$scope.sendMessage=function(){""!=$scope.writingMessage&&null!==$scope.currentClient&&$scope.currentClient.isActive&&($scope.list_messages[$scope.currentClient.id].messages.push({username:"Д.Жавхлантөгс",content:$scope.writingMessage}),socket.emit("Operator2Client",{clientId:$scope.currentClient.id,msg:$scope.writingMessage}),$scope.writingMessage="",$scope.$emit("changed"))},$scope.userClose=function(user){$scope.tunnel_users.forEach(function(el,i){el.id===user.id&&($scope.tunnel_users.splice(i,1),$scope.messages=[],$scope.currentClient=null,socket.emit("set:noreply:user",user.id))})},$scope.selected=function(user){console.log(user),user.count=0,$scope.currentClient=user,$scope.$emit("changed")},$scope.tunnel=function(user){user.isActive=!0,$scope.tunnel_users.push(user),$scope.list_messages[user.id]||($scope.list_messages[user.id]={messages:[]});for(var i=0;i<user.conversations.length;i++)$scope.list_messages[user.id].messages.push({username:user.fullname,content:user.conversations[i]});$scope.selected(user),socket.emit("tunnel",user.id)},socket.on("noreply:users",function(users){window.nono=$scope.noreply_users=users}),socket.on("client:left",function(id){$scope.tunnel_users.forEach(function(el,i){el.id===id&&(el.isActive=!1,$scope.list_messages[id].messages.push({username:el.fullname,content:"Системээс гарлаа."}),$scope.$emit("changed"))})}),socket.on("notifications",function(data){console.log("notifications"),console.log("data: ",data),$scope.tunnel_users.forEach(function(el,i){el.id===data.id&&(el.count=el.count||0,el.count=el.count+1,data.fullname=el.fullname)}),void 0!==$scope.list_messages[data.id].messages?$scope.list_messages[data.id].messages.push({username:data.fullname,content:data.msg}):alert("notification error.")})}]),angular.module("myApp",[]).factory("Chat",function(){function sendMessage(name,text){messages.push({name:name,text:text})}var messages=[];return{messages:messages,sendMessage:sendMessage}}).directive("mySimpleChat",["Chat",function(chat){var tmpl='<div><h2>{{title}}</h2><input type="text" ng-model="name" placeholder="Type your name"/><hr /><form ng-submit="sendMessage()"><input type="text" ng-model="text" required placeholder="Type a new message..."/><input type="submit" id="submit" value="Send"/></form><ul><li ng-repeat="message in messages"><strong>{{message.name}}</strong> {{message.text}}</li></ul><div>';return{restrict:"E",replace:!0,scope:{title:"@title"},template:tmpl,controller:["$scope","$element","$attrs","$transclude",function($scope,$element,$attrs,$transclude){$scope.name=$scope.title,$scope.text="",$scope.sendMessage=function(){chat.sendMessage($scope.name,$scope.text),$scope.text=""}}],link:function($scope,element,attributes){$scope.messages=chat.messages}}}]),angular.module("livechat").config(["$stateProvider",function($stateProvider){$stateProvider.state("livechat",{url:"/livechat",templateUrl:"modules/livechat/views/livechat.main.html"}).state("livechat-login",{url:"/livechat/login",templateUrl:"modules/livechat/views/livechat.login.html"})}]),angular.module("merchants").controller("MerchantController",["$rootScope","$scope","$stateParams","$location","Authentication","$http",function($rootScope,$scope,$stateParams,$location,Auth,$http){Auth.authorize(Auth.user_roles.merchant)||$location.path("/"),$scope.notify_count=0,$scope.merchantFormDisable=!0,$scope.saveBtn=!0,$scope.mrchChBtn=!1,$scope.pswdChBtn=!0,$scope.user=Auth.user,$scope.MerchantFormDisable=!0,$scope.currentPage=1,$scope.date=new Date,$scope.hourStep=1,$scope.reportFileName="",$scope.image="",$scope.minuteStep=1,$scope.reportFileHide=!0,$scope.minDate=$scope.minDate?null:new Date,$scope.purchaseDate=$scope.date,$scope.pageTop=function(){pageTop()};var da=new Date;da.setDate(da.getDate());var dates=da.getFullYear()+"-0"+(da.getMonth()+1)+"-"+da.getDate();$http.get("/api/v1/merchant/purchaseReportDays?begin={0}&end={1}".format(dates+" 00:00:33",dates+" 23:59:33")).success(function(data){$scope.purchaseReportDay=data,$scope.purchaseDate=da}).error(function(message){$rootScope.notifyMessage=message}),$scope.prePurchaseDay=function(data){var d=new Date(data);d.setDate(d.getDate()-1);var data=d.getFullYear()+"-0"+(d.getMonth()+1)+"-"+d.getDate();$scope.purchaseDate=d,$http.get("/api/v1/merchant/purchaseReportDays?begin={0}&end={1}".format(data+" 00:00:33",data+" 23:59:33")).success(function(data){$scope.purchaseReportDay=data}).error(function(message){$rootScope.notifyMessage=message})},$scope.forPurchaseDay=function(data){var d=new Date(data);d.setDate(d.getDate()+1);var data=d.getFullYear()+"-0"+(d.getMonth()+1)+"-"+d.getDate();$scope.purchaseDate=d,$http.get("/api/v1/merchant/purchaseReportDays?begin={0}&end={1}".format(data+" 00:00:33",data+" 23:59:33")).success(function(data){$scope.purchaseReportDay=data;

}).error(function(message){$rootScope.notifyMessage=message})},$http({method:"POST",url:"/api/v1/merchant/org/get"}).success(function(data){void 0!=data&&data?($scope.organization=data,$scope.orgImage=data.image,$scope.organization.desc=data.short_description,$scope.orgSaveBtn=!0):$scope.orgSaveBtn=!1}).error(function(data){}),$scope.orgEdit=function(){$scope.orgSaveBtn=!1},$scope.menus=[{title:"Хянах самбар",href:"#!/merchant"},{title:"Мэдээлэл",href:"#!/merchant/posconfirm",notif:$scope.notify_count},{title:"Пос терминал",href:"#!/merchant/poslist"},{title:"Борлуулалтын тайлан",href:"#!/merchant/document"},{title:"Борлуулалтын мэдээ",href:"#!/merchant/report"},{title:"Хувийн тохиргоо",href:"#!/merchant/setting"}],$scope.salesDay={lottery_count:0,sale_amount:0,vat_amount:0,cash_amount:0,noncash_amount:0,year:0,month:0},$http.get("/users/getImage").success(function(data){$scope.user.image=data.image}).error(function(data){}),$scope.posActiveConfirm=function(pos,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"ПОС-ын мэдээлэл",message:"Та ("+pos.address+"-"+pos.no+") посыг идэвхигүй болгохдоо итгэлтэй байна уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http.put("/api/v1/merchant/deactivateByMerchant/{0}".format(pos.id)).success(function(message){$rootScope.notifyMessage=message,$scope.posActiveList.forEach(function(el){el.id==pos.id&&($scope.posActiveList.splice(index,1),$scope.posInactiveList.unshift(el))})}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){$scope.saveBtn=!0,dialogItself.close()}}]})},$scope.posInactiveConfirm=function(pos,index){BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"ПОС-ын мэдээлэл",message:"Та ("+pos.address+"-"+pos.no+") посыг идэвхижүүлэхдээ итгэлтэй байна уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http.put("/api/v1/merchant/posConfirm/{0}".format(pos.id)).success(function(message){$rootScope.notifyMessage=message,$scope.posInactiveList.forEach(function(el){el.id==pos.id&&($scope.posInactiveList.splice(index,1),$scope.posActiveList.unshift(el))})}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){$scope.saveBtn=!0,dialogItself.close()}}]})},$http.get("/api/v1/merchant/posList").success(function(data){$scope.posActiveList=[],$scope.posInactiveList=[],data.terminals.forEach(function(el){switch(el.type){case"0":el.image="img/pos-java.png";break;case"1":el.image="img/pos-windows.png";break;case"2":el.image="img/pos-android.png"}void 0!=el.address&&el.address||(el.address="Тодорхойгүй"),"1"==el.status?$scope.posActiveList.push(el):$scope.posInactiveList.push(el)})}).error(function(){$scope.posList=[]}),$scope.fileNameChanged=function(files){},$scope.saveMerchant=function(){$http.put("/users",{user:$scope.user}).success(function(message){$rootScope.notifyMessage=message,$scope.mrchChBtn=!1}).error(function(message){$rootScope.notifyMessage=message})},$scope.passwordChange=function(oldPass,newPass,confPass){newPass==confPass&&""!=newPass&&newPass?BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"Нууц үг солих",message:"Та нууц үгээ солихдоо итгэлтэй байна уу?",buttons:[{label:"Тийм",cssClass:"btn-global-accept btn-m",action:function(dialogItself){$http.post("/users/passwordChange",{oldPassword:oldPass,newPassword:newPass}).success(function(message){$rootScope.notifyMessage=message}).error(function(message){$rootScope.notifyMessage=message}),dialogItself.close()}},{label:"Үгүй",cssClass:"btn-global-reject btn-m",action:function(dialogItself){$scope.saveBtn=!0,dialogItself.close()}}]}):$rootScope.notifyMessage={message:"Нууц үг буруу байна шалгаад дахин оруулана уу",type:0}},$scope.purchaseReportDays={data:"purchaseReportDay",showGridFooter:!1,enableSorting:!0,enableColumnMenus:!1,enableHiding:!1,paginationPageSizes:[5,10,15],paginationPageSize:5,enableFiltering:!0,columnDefs:[{field:"amount.low",displayName:"Мөнгөн дүн"},{field:"comment",displayName:"Тайлбар"},{field:"lottery_no",displayName:"Сугалааны дугаар"},{field:"receipt_date",displayName:"Бүртгэсэн өдөр",type:"date",format:"yyyy/MM/dd"},{field:"receipt_id.low",displayName:"Бүртгэлийн дугаар"}]},$scope.posConfirm=function(pos){$http.put("/api/v1/merchant/posConfirm/{0}".format(pos.id)).success(function(message){$rootScope.notifyMessage=message,$scope.notify_count--}).error(function(message){$rootScope.notifyMessage=message})},$scope.timelget=function(){$http.get("/api/v1/merchant/timeline").success(function(data){$scope.timel=data,$rootScope.timel1=data}).error(function(data){})},$scope.getReportLog=function(){$http.get("/api/v1/merchant/getReportLog").success(function(data){$scope.reportLogs=data,$scope.reportLogs.forEach(function(el){el.ani=1==$scope.dateDiffSecond(el.date)?"animate":""})}).error(function(data){})},$scope.model={name:"",comments:""},$scope.init=function(){$http.get("/api/v1/sales/list").success(function(data){$scope.salesdata=data}),$http.get("/api/v1/merchant/posList").success(function(data,status,headers,config){$scope.posList=data.terminals,$scope.posListTotal=data.total}).error(function(data,status,headers,config){$scope.posList=[]}),$http.get("/api/v1/merchant/purchaseByDay").success(function(data){buildChart("chart-consumer-day",data,"day","line")}).error(function(data){$scope.chart=data}),$http.get("/api/v1/merchant/purchaseByMonth").success(function(data){buildChart("chart-consumer-month",data,"month","column")}).error(function(data){$scope.chart=data}),$http.get("/api/v1/merchant/getChartCategory").success(function(data){buildChart("chart-consumer-pie",data,"pie","pie")}),$scope.salesPercent=0,$http.get("/api/v1/merchant/purchaseByMonth?before=1").success(function(data){$scope.salesMonth=_.findWhere(data,{month:(new Date).getMonth()+1}),$scope.salesMonthBefore=_.findWhere(data,{month:(new Date).getMonth()}),void 0==$scope.salesMonth||void 0==$scope.salesMonthBefore?($scope.salesMonth=_.extend({amount:0,year:(new Date).getFullYear(),month:(new Date).getMonth()}),$scope.salesPercent=0,$scope.salesPercentGlyph=1):100*$scope.salesMonthBefore.amount/$scope.salesMonth.amount>100?($scope.salesPercent=100*$scope.salesMonthBefore.amount/$scope.salesMonth.amount-100,$scope.salesPercentGlyph=1):($scope.salesPercent=100-100*$scope.salesMonthBefore.amount/$scope.salesMonth.amount,$scope.salesPercentGlyph=0)})},$scope.files=[],$scope.$on("fileSelected",function(event,args){$scope.progresss=0,$scope.files.push(args.file),$scope.$apply(function(){if("organizationImage"==args.id)$scope.organizationImageChange();else if("report"==args.id)"text/plain"==args.file.type?($scope.reportFileHide=!1,$scope.reportFileName=args.file.name):($rootScope.notifyMessage={message:"Та зөв файл сонгонуу?",type:0},$scope.reportFileHide=!0);else{if(args.file.size/1024>1024)return void($rootScope.notifyMessage={message:"Таны оруулсан зураг хэтэрхий том байна 1mb-аас бага хэмжээтэй зураг оруулана уу",type:2});$scope.mrchChBtn=!0,$scope.accountImageChange()}$scope.files=[]})}),$scope.saveOrganization=function(desc,address,name){$http({method:"POST",url:"/api/v1/merchant/org/save",data:{desc:desc,address:address,name:name,image:$scope.orgImage,orgId:$scope.organization.id}}).success(function(data){$rootScope.notifyMessage=data,$http({method:"POST",url:"/api/v1/merchant/org/get"}).success(function(data){$scope.organization=data,$scope.orgImage=data.image,$scope.organization.desc=data.short_description,$scope.orgSaveBtn=!0}).error(function(data){})}).error(function(data){$rootScope.notifyMessage=data})},$scope.companyImageChange=function(){$http({method:"POST",url:" /api/v1/merchant/org/save",headers:{"Content-Type":void 0},transformRequest:function(data){var formData=new FormData;formData.append("model",angular.toJson($scope.user));for(var i=0;i<data.files.length;i++)formData.append("file"+i,data.files[i]);return formData},data:{model:$scope.model,files:$scope.files}}).success(function(data,status,headers,config){Auth.user.image="/img/"+data.file0.name}).error(function(data,status,headers,config){$rootScope.notifyMessage={message:"Зураг солиход алдаа гарлаа: "+data,type:2}})},$scope.accountImageChange=function(){$http({method:"POST",url:" /api/v1/filemanager/upload",headers:{"Content-Type":void 0},transformRequest:function(data){var formData=new FormData;formData.append("model",angular.toJson($scope.user));for(var i=0;i<data.files.length;i++)formData.append("file"+i,data.files[i]);return formData},data:{model:$scope.model,files:$scope.files}}).success(function(data,status,headers,config){Auth.user.image="/img/"+data.file0.name}).error(function(data,status,headers,config){$rootScope.notifyMessage={message:"Зураг солиход алдаа гарлаа: "+data,type:2}})},$scope.organizationImageChange=function(){$http({method:"POST",url:" /api/v1/filemanager/upload",headers:{"Content-Type":void 0},transformRequest:function(data){var formData=new FormData;formData.append("model",angular.toJson($scope.user));for(var i=0;i<data.files.length;i++)formData.append("file"+i,data.files[i]);return formData},data:{model:$scope.model,files:$scope.files}}).success(function(data,status,headers,config){$scope.orgImage="/img/"+data.file0.name}).error(function(data,status,headers,config){$rootScope.notifyMessage={message:"Зураг солиход алдаа гарлаа: "+data,type:2}})},$scope.report=function(){var x=document.getElementById("report");if("files"in x)if(0==x.files.length)$rootScope.notifyMessage={message:"Та явуулах тайлангаа оруулана уу?",type:0};else{var fd=new FormData;fd.append("uploadedFile",x.files[0]);var xhr=new XMLHttpRequest;xhr.addEventListener("progress",function(evt){$scope.$apply(function(){evt.lengthComputable&&($scope.progresss=Math.round(80*evt.loaded/evt.total))})},!0),xhr.upload.addEventListener("loadend",function(e){console.log(e)}),xhr.onreadystatechange=function(){4===xhr.readyState&&(200==xhr.status&&xhr.status<300?($rootScope.notifyMessage=JSON.parse(xhr.responseText),$scope.reportFileHide=!0,$scope.progresss=100,setTimeout(function(){$scope.progresss=0},1500),$scope.getReportLog(),$scope.setTimeLine(0,"Тайлан амжилттай явуулсан",1)):($rootScope.notifyMessage=JSON.parse(xhr.responseText),$scope.setTimeLine(0,"Тайлан амжилтгүй явуулсан",1)))},xhr.open("POST","/api/v1/merchant/sendReport"),xhr.send(fd)}setTimeout(function(){$(".animate").animate({opacity:0},800,function(){$(".animate").css({backgroundColor:"silver"})}).animate({opacity:1},800,function(){$(".animate").css({backgroundColor:"white"}),$scope.progresss=0})},1500)},$scope.gridOptions={data:"showprofileMerchant",showGridFooter:!1,enableFiltering:!0,enableColumnMenus:!1,enableHiding:!1,enableSorting:!1,columnDefs:[{field:"posNo",width:"15%",displayName:"Посын дугаар"},{field:"saleAmount",displayName:"Гүйлгээний дүн"},{field:"receiptCount",displayName:"Баримтын тоо"},{field:"vatAmount",displayName:"НӨАТ дүн"}]},$scope.gridOptions={data:"showprofileConsumer",showGridFooter:!1,enableFiltering:!0,enableColumnMenus:!1,enableHiding:!1,enableSorting:!1,columnDefs:[{field:"consumerID",width:"15%",displayName:"Хэрэглэгч дугаар"},{field:"salesAmount",displayName:"Гүйлгээний дүн"},{field:"vatAmount",displayName:"НӨАТ дүн"},{field:"receiptCount",displayName:"Баримтын тоо"}]},$scope.showprofileMerchant=function(){$http.get("/api/v1/merchant/showMerchantProf").success(function(data,status,headers,config){if(void 0!==data)if(Array.isArray(data.pos_data))$scope.showprofileMerchant=data.pos_data;else{var pro=[{posId:data.pos_data.posId,saleAmount:data.pos_data.saleAmount,posNo:data.pos_data.posNo,receiptCount:data.pos_data.receiptCount,salesAmount:data.pos_data.salesAmount}];$scope.showprofileMerchant=pro}})},$scope.showprofileConsumer=function(){$http.get("/api/v1/merchant/showConsumerProf").success(function(data,status,headers,config){if(void 0!==data)if(Array.isArray(data.consumer_data))$scope.showprofileConsumer=data.consumer_data;else{var prf=[{salesAmount:data.consumer_data.salesAmount,vatAmount:data.consumer_data.vatAmount,consumerId:data.consumer_data.consumerId,receiptCount:data.consumer_data.receiptCount}];$scope.showprofileConsumer=prf}})},$scope.today=function(){$scope.dt=new Date},$scope.today(),$scope.clear=function(){$scope.dt=null},$scope.disabled=function(date,mode){return!1},$scope.toggleMin=function(){$scope.minDate=$scope.minDate?null:new Date},$scope.toggleMin(),$scope.purchaseDaySelect=function(data){var d=new Date(data);d.setDate(d.getDate());var data=d.getFullYear()+"-0"+(d.getMonth()+1)+"-"+d.getDate();$scope.purchaseDate=d,$http.get("/api/v1/merchant/purchaseReportDays?begin={0}&end={1}".format(data+" 00:00:33",data+" 23:59:33")).success(function(data){$scope.purchaseReportDay=data}).error(function(message){$rootScope.notifyMessage=message})},$scope.open=function($event){$scope.opened=!0,$event.preventDefault(),$scope.opened=!0,$event.stopPropagation(),$scope.opened=!0},$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.formats=["dd-MMMM-yyyy"],$scope.format=$scope.formats[0],$scope.dateDiffSecond=function(date){var a=new Date(date),b=new Date,difference=(b-a)/1e3;return 10>=difference?!0:!1},$scope.setTimeLine=function(amount,message,origin){$http({method:"POST",url:"/api/v1/timeline",data:{amount:amount,message:message,origin:origin}}).success(function(data,status,headers,config){}).error(function(data,status,headers,config){})}}]),angular.module("merchants").config(["$stateProvider",function($stateProvider){$stateProvider.state("merchant",{url:"/merchant","abstract":!0,templateUrl:"modules/merchants/views/index-merchant.client.view.html",controller:"MerchantController"}).state("merchant.dashboard",{url:"",templateUrl:"modules/merchants/views/dashboard-merchant.client.view.html"}).state("merchant.posconfirm",{url:"/posconfirm",templateUrl:"modules/merchants/views/posconfirm-merchant.client.view.html"}).state("merchant.setting",{url:"/setting",templateUrl:"modules/merchants/views/setting-merchant.client.view.html"}).state("merchant.doc",{url:"/document",templateUrl:"modules/merchants/views/document-merchant.client.view.html"}).state("merchant.report",{url:"/report",templateUrl:"modules/merchants/views/report-merchant.client.view.html"}).state("merchant.poslist",{url:"/poslist",templateUrl:"modules/merchants/views/poslist-merchant.client.view.html"})}]),angular.module("operators").controller("OperatorController",["$rootScope","$scope","$stateParams","$location","$http","Authentication","socket",function($rootScope,$scope,$stateParams,$location,$http,Authentication,socket){var cities=[{}];if(!Authentication.authorize(Authentication.user_roles.operator))return $location.path("/");$scope.user=Authentication.user,$scope.currentPage=1,$scope.controllerName="OperatorController",$scope.username=$scope.user.username,$scope.saveBtn=!0,$scope.merchantRegValid=!1,$scope.pageTop=function(){pageTop()},$scope.menus=[{title:"Хянах самбар",href:"#!/operator"},{title:"Терминал API",href:"#!/operator/pos"},{title:"ПОС бүртгэх",href:"#!/operator/add"},{title:"Харилцагч",href:"#!/operator/partner"}],$scope.regDate=new Date,$scope.saveConsumer=function(){$http.put("/users",{user:$scope.user}).success(function(data){$rootScope.notifyMessage=data,$scope.saveBtn=!0}).error(function(data){$rootScope.notifyMessage=data})},$scope.add=function(merchantReg,programType,macAddress,address,lat,long,posNumber){var formvalid=!0;if(0==formValidBeforeSubmit("address","")&&(formvalid=!1),0==formValidBeforeSubmit("macAddress","^([0-9A-Fa-f]{2}[\\.:-]){5}([0-9A-Fa-f]{2})$")&&(formvalid=!1),0==formValidBeforeSubmit("posNumber","^[0-9]+$")&&(formvalid=!1),0==formValidBeforeSubmit("merchantReg","^([0-9]{7})$")&&(formvalid=!1),1==formvalid){var newPos={merchantTin:""+merchantReg,type:programType,macAddress:macAddress,address:address,latitude:""+lat,longitude:""+long,no:posNumber};window.scrollTo(0,0),$http.post("/api/v1/operator/posAdd",newPos).success(function(data){$rootScope.notifyMessage=data,document.getElementById("merchant_form").reset(),$scope.setTimeLine(0,"Пос амжилттэй бүртгэлээ "+posNumber,1),$http.get("/api/v1/operator/posList?index=1&size=50").success(function(data,status,headers,config){$scope.posList=data.terminals,$scope.posListTotal=data.total,$scope.posList.forEach(function(el){el.longitude&&el.longitude&&cities.push({longitude:el.longitude,latitude:el.latitude})})}).error(function(){$scope.posList=[]})}).error(function(data){$rootScope.notifyMessage=data,$scope.merchant_form=null,$scope.setTimeLine(0,"Пос амжилтгүй бүртгэлээ "+posNumber,2),document.getElementsByName("merchantReg").item(0).textContent=""})}},$scope.gridOptions={data:"posList",enableSorting:!0,enableFiltering:!0,enableColumnMenus:!1,enableHiding:!1,paginationPageSizes:[50,100,150],paginationPageSize:50,columnDefs:[{field:"no",width:"10%",displayName:"№"},{field:"macAddress",displayName:"Физик хаяг"},{field:"regDate",displayName:"Бүртгэсэн огноо",enableSorting:!0},{field:"type",displayName:"Төрөл"},{field:"merchantName",displayName:"Борлуулагчийн нэр"},{field:"status",displayName:"Төлөв"}]},$scope.getPageDatas=function(data){var index=1;1!=data&&(index=50*data-50),$http.get("/api/v1/operator/posList?index="+index+"&size=50").success(function(data,status,headers,config){$scope.posList=data.terminals,$scope.posList.forEach(function(el){el.longitude&&el.longitude&&cities.push({longitude:el.longitude,latitude:el.latitude})})}).error(function(){$scope.posList=[]})},$http.get("/api/v1/operator/posList?index=1&size=50").success(function(data,status,headers,config){$scope.posList=data.terminals,$scope.posListTotal=data.total,$scope.posList.forEach(function(el){el.longitude&&el.longitude&&cities.push({longitude:el.longitude,latitude:el.latitude})})}).error(function(){$scope.posList=[]}),$http.get("/users/getImage",{id:$scope.user.id}).success(function(data){$scope.user.image=data.image}),function(){$http.get("/api/v1/operator/showPosStat").success(function(data){$scope.posTerminalCount=data.posTerminalCount,$scope.merchantCount=data.merchantCount,$scope.activePosCount=data.activePosCount,$scope.inactivePosCount=data.inactivePosCount}).error(function(data){$scope.posTerminalCount=0,$scope.merchantCount=0,$scope.activePosCount=0,$scope.inactivePosCount=0})}(),$scope.map={center:{latitude:47.920303,longitude:106.918952},zoom:12,bounds:{}},$scope.options={scrollwheel:!1},$scope.coordsUpdates=0,$scope.dynamicMoveCtr=0,$scope.marker={id:0,coords:{latitude:40.1451,longitude:-99.668},options:{draggable:!0},events:{dragend:function(marker,eventName,args){marker.getPosition().lat(),marker.getPosition().lng();$scope.marker.options={draggable:!0,labelAnchor:"100 0",labelClass:"marker-labels"}}}},$scope.$watchCollection("marker.coords",function(newVal,oldVal){_.isEqual(newVal,oldVal)||$scope.coordsUpdates++}),setTimeout(function(){$scope.marker.coords={latitude:47.920303,longitude:106.918952},$scope.dynamicMoveCtr++,setTimeout(function(){$scope.marker.coords={latitude:47.920303,longitude:106.918952},$scope.dynamicMoveCtr++},2e3)},1e3),$scope.posMarkers=[];var createRandomMarker=function(i,bounds,idKey){null==idKey&&(idKey="id");var latitude=cities[i].latitude,longitude=cities[i].longitude,ret={latitude:latitude,longitude:longitude,icon:{url:"img/pin.png"}};return ret[idKey]=i,ret};$scope.$watch(function(){return $scope.map.bounds},function(nv,ov){if(!ov.southwest&&nv.southwest){for(var markers=[],i=0;i<cities.length;i++)markers.push(createRandomMarker(i,$scope.map.bounds));$scope.posMarkers=markers}},!0),$scope.markerIcon={url:"img/newMarker.png"},$scope.submitted=!1,$scope.setSelected=function(){$scope.selected=this.pos,1===$scope.selected.ptStatus?$scope.selected.ptStatus=0:0===$scope.selected.ptStatus&&($scope.selected.ptStatus=1)},$scope.download=function(filename){window.location="/download/"+filename},$scope.files=[],$scope.$on("fileSelected",function(event,args){$scope.$apply(function(){return $scope.files.push(args.file),args.file.size/1024>1024?void($rootScope.notifyMessage={message:"Таны оруулсан зураг хэтэрхий том байна 1mb-аас бага хэмжээтэй зураг оруулана уу",type:0}):($scope.imageError="",$scope.saveBtn=!1,$scope.accountImageChange(),void($scope.files=[]))})}),$scope.accountImageChange=function(){$http({method:"POST",url:"/api/v1/filemanager/upload",headers:{"Content-Type":void 0},transformRequest:function(data){var formData=new FormData;formData.append("model",angular.toJson($scope.user));for(var i=0;i<data.files.length;i++)formData.append("file"+i,data.files[i]);return formData},data:{model:$scope.model,files:$scope.files}}).success(function(data,status,headers,config){Authentication.user.image="/img/"+data.file0.name}).error(function(data,status,headers,config){$rootScope.notifyMessage={message:"Зураг солиход алдаа гарлаа: "+data,type:2}})},$scope.file_changed=function(element){var photofile=element[0],reader=new FileReader;reader.onload=function(e){var img=new Image;img.src=e.target.result,img.onload=function(){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=150,canvas.height=150,ctx.drawImage(img,0,0,img.width,img.height,0,0,151,151),document.getElementById("imgPre").src=canvas.toDataURL("image/jpg")},$scope.$apply()},reader.readAsDataURL(photofile)},$scope.merchantRegValidK=function(merchantReg){$scope.merchantRegValid=""==merchantReg||void 0==merchantReg?!0:!1},$scope.merchantRegValidK=function(merchantReg){$scope.merchantRegValid=""==merchantReg||void 0==merchantReg?!0:!1},$scope.merchantRegValidK=function(merchantReg){$scope.merchantRegValid=""==merchantReg||void 0==merchantReg?!0:!1},$scope.merchantRegValidK=function(merchantReg){$scope.merchantRegValid=""==merchantReg||void 0==merchantReg?!0:!1},$scope.setTimeLine=function(amount,message,origin){$http({method:"POST",url:"/api/v1/timeline",data:{amount:amount,message:message,origin:origin}}).success(function(data,status,headers,config){}).error(function(data,status,headers,config){})}}]),angular.module("operators").config(["$stateProvider",function($stateProvider){$stateProvider.state("operator",{url:"/operator","abstract":!0,templateUrl:"modules/operators/views/index-operator.client.view.html",title:"Оператор компаний мэдээлэл",controller:"OperatorController"}).state("operator.dashboard",{url:"",templateUrl:"modules/operators/views/dashboard-operator.client.view.html",title:"Оператор компаний мэдээлэл"}).state("operator.pos",{url:"/pos",templateUrl:"modules/operators/views/pos-operator.client.view.html"}).state("operator.add",{url:"/add",templateUrl:"modules/operators/views/create-operator.client.view.html"}).state("operator.message",{url:"/message",templateUrl:"modules/operators/views/message-operator.client.view.html"}).state("operator.notification",{url:"/notification",templateUrl:"modules/operators/views/notification-operator.client.view.html"}).state("operator.partner",{url:"/partner",templateUrl:"modules/operators/views/partner-operator.client.view.html"}).state("operator.edit",{url:"/edit",templateUrl:"modules/operators/views/edit-operator.client.view.html"})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$rootScope","$scope","$http","$location","Authentication",function($rootScope,$scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.formHide=!1,$scope.signups=function(){console.log($scope.user),$http.post("/auth/signup",$scope.user).success(function(data){$scope.formHide=!0}).error(function(response){$scope.formHide=!1,$rootScope.notifyMessage=response})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this,user_roles={admin:0,consumer:1,merchant:2,operator:3,monitoring:4};return _this._data={user:window.user},{user:_this._data.user,user_roles:user_roles,authorize:function(role){var user=_this._data.user||null;return user&&role==user.accType?!0:!1}}}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);